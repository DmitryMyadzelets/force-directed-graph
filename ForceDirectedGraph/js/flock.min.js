var Attractor,Bot,BotBuilder,Drag,EdgeBounce,EdgeWrap,Magnet,Mouse,Noise,Repulsor,Rnd,Spring,Vector;Drag=(function(){function b(){}b.isActive=true;b.applyForce=function(a,g){var f,h;if(g==null){g=0.05}if(!b.isActive){return}h=a.velocity.mag();f=a.velocity.get();f.mult(-1);f.normalize();f.mult(g*h*h);return a.accelerate(f)};return b})();EdgeBounce=(function(){function b(){}b.applyForce=function(a){var g,h,i,j;g=a.location.x-window.width;h=a.location.x;if(g>0){a.accelerate(new Vector(-g,0))}if(h<0){a.accelerate(new Vector(-h,0))}i=a.location.y-window.height;j=a.location.y;if(i>0){a.accelerate(new Vector(0,-i))}if(j<0){return a.accelerate(new Vector(0,-j))}};return b})();EdgeWrap=(function(){function b(){}b.applyForce=function(a){var g,h,i,j;g=a.location.x-window.width;h=a.location.x;if(g>0){a.location.x=0}if(h<0){a.location.x=window.width}i=a.location.y-window.height;j=a.location.y;if(i>0){a.location.y=0}if(j<0){return a.location.y=window.height}};return b})();Magnet=(function(){function b(){}b.isActive=true;b.applyForce=function(a,g,j){var h,i;if(j==null){j=10}if(!b.isActive){return}i=Vector.sub(a.location,g.location);h=i.mag();i.normalize();i.mult((j*a.mass*g.mass)/(h*h));return a.accelerate(i)};return b})();Mouse=(function(){function b(){}b.isActive=false;b.applyForce=function(a,h){var g,i,j;if(h==null){h=0.7}if(!b.isActive){return}i=window.processing;j=new Vector(i.mouseX,i.mouseY);g=Vector.sub(j,a.location);g.normalize();g.mult(h);return a.accelerate(g)};return b})();Noise=(function(){function b(){}b.isActive=false;b.applyForce=function(a,g,h){var i,j;if(g==null){g=5}if(h==null){h=2}if(!this.isActive||h===0||Rnd.gate(100-g)){return}i=Rnd.next(h*a.mass)*Rnd.sign();j=Rnd.next(h*a.mass)*Rnd.sign();return a.accelerate(new Vector(i,j))};return b})();Spring=(function(){function b(){}b.isActive=true;b.applyForce=function(a,i,m,n){var j,k,l;if(m==null){m=0.01}if(n==null){n=50}if(!Magnet.isActive){return}l=Vector.sub(a.location,i.location);j=l.mag();k=n-j;l.normalize();l.mult(m*k);a.accelerate(l);l.mult(-1);return i.accelerate(l)};return b})();Attractor=(function(){b.isVisible=true;function b(){this.p=window.processing;this.mass=2;this.acceleration=new Vector;this.velocity=Rnd.velocity();this.location=Rnd.location();this.accelerationChance=0}b.prototype.move=function(){this.changeVector();this.velocity.add(this.acceleration);this.velocity.limit(3);this.location.add(this.velocity);return this.acceleration.mult(0)};b.prototype.changeVector=function(){var a,d;this.accelerationChance++;if(!Rnd.gate(this.accelerationChance/1000)){return}this.accelerationChance=0;a=Rnd.next(20)*Rnd.sign();d=Rnd.next(20)*Rnd.sign();return this.accelerate(new Vector(a,d))};b.prototype.drawShape=function(){if(!b.isVisible){return}this.p.pushMatrix();this.p.translate(this.location.x,this.location.y);this.p.rotate(this.velocity.heading());this.p.scale(0.5+this.mass/8);this.p.fill(255,128,128);this.p.stroke(255,0,0);this.p.triangle(-4,4,8,0,-4,-4);return this.p.popMatrix()};b.prototype.applyForce=function(a){var d;d=Vector.sub(this.location,a.location);d.normalize();return a.accelerate(d)};b.prototype.accelerate=function(a){return this.acceleration.add(Vector.div(a,this.mass))};return b})();Repulsor=(function(){b.isVisible=true;function b(){this.p=window.processing;this.mass=Rnd.next(500,200);this.size=this.mass/10;this.location=Rnd.location(this.size)}b.prototype.drawShape=function(){if(!b.isVisible){return}this.p.pushMatrix();this.p.fill(102);this.p.stroke(128,64,64);this.p.ellipse(this.location.x,this.location.y,this.size,this.size);return this.p.popMatrix()};b.prototype.applyForce=function(a){return Magnet.applyForce(a,this,2)};return b})();Bot=(function(){function b(a){this.mass=a!=null?a:(Math.random()*10)+1;this.p=window.processing;this.acceleration=new Vector;this.velocity=Rnd.velocity();this.location=Rnd.location();this.friends=[]}b.prototype.drawShape=function(){this.p.pushMatrix();this.p.translate(this.location.x,this.location.y);this.p.rotate(this.velocity.heading());this.p.scale(0.5+this.mass/8);this.p.fill(128,255,128);this.p.stroke(0,255,0);this.p.triangle(-4,4,8,0,-4,-4);return this.p.popMatrix()};b.prototype.drawLines=function(){var h,a,f,g;this.p.pushMatrix();this.p.stroke(75);g=this.friends;for(a=0,f=g.length;a<f;a++){h=g[a];this.p.line(this.location.x,this.location.y,h.location.x,h.location.y)}return this.p.popMatrix()};b.prototype.move=function(){this.velocity.add(this.acceleration);this.velocity.limit(3);this.location.add(this.velocity);return this.acceleration.mult(0)};b.prototype.accelerate=function(a){return this.acceleration.add(Vector.div(a,this.mass))};return b})();BotBuilder=(function(){function b(){}b.flock=function(a){var e,f;e=(function(){var c;c=[];for(f=0;0<=a?f<a:f>a;0<=a?f++:f--){c.push(new Bot(Rnd.next(3,1)))}return c})();return e};b.graphSpokes=function(){var a,e,f;a=new Bot(4);e=(function(){var c;c=[];for(f=0;f<10;f++){c.push(new Bot(4))}return c})();a.friends=e;return e.concat(a)};b.graphSwarm=function(){var a,f,g,h;a=new Bot(6);f=(function(){var c;c=[];for(h=0;h<16;h++){c.push(new Bot(4))}return c})();g=(function(){var c;c=[];for(h=0;h<24;h++){c.push(new Bot(1))}return c})();a.friends=f.concat(g);return f.concat(a,g)};b.graphMolecule=function(){var a,c,h,i,n,o,p,q,r;a=(function(){var d;d=[];for(r=0;r<6;r++){d.push(new Bot(5))}return d})();h=(function(){var d;d=[];for(c=0;c<3;c++){d.push(new Bot(3))}return d})();i=(function(){var d;d=[];for(c=0;c<2;c++){d.push(new Bot(3))}return d})();n=(function(){var d;d=[];for(c=0;c<2;c++){d.push(new Bot(3))}return d})();o=(function(){var d;d=[];for(c=0;c<2;c++){d.push(new Bot(3))}return d})();p=(function(){var d;d=[];for(c=0;c<2;c++){d.push(new Bot(3))}return d})();q=(function(){var d;d=[];for(c=0;c<3;c++){d.push(new Bot(3))}return d})();a[0].friends=h.concat([a[1]]);a[1].friends=i.concat([a[2]]);a[2].friends=n.concat([a[3]]);a[3].friends=o.concat([a[4]]);a[4].friends=p.concat([a[5]]);a[5].friends=q;return a.concat(h,i,n,o,p,q)};b.graphBlossom=function(){var i,V,X,Z,ab,ad,af,ai,ak,am,ao,aq,at,av,ax,az,aB,aD,aF,aG,aH,aI,aJ,aK,a,U,W,Y,aa,ac,ae,ag,ah,aj,al,an,ap,ar,au,aw,ay,aA,aC,aE;i=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(8))}return c})();V=(function(){var c;c=[];for(aE=0;aE<4;aE++){c.push(new Bot(4))}return c})();X=(function(){var c;c=[];for(aE=0;aE<4;aE++){c.push(new Bot(4))}return c})();Z=(function(){var c;c=[];for(aE=0;aE<4;aE++){c.push(new Bot(2))}return c})();ab=(function(){var c;c=[];for(aE=0;aE<4;aE++){c.push(new Bot(2))}return c})();ad=(function(){var c;c=[];for(aE=0;aE<4;aE++){c.push(new Bot(2))}return c})();af=(function(){var c;c=[];for(aE=0;aE<4;aE++){c.push(new Bot(2))}return c})();ai=(function(){var c;c=[];for(aE=0;aE<4;aE++){c.push(new Bot(2))}return c})();ak=(function(){var c;c=[];for(aE=0;aE<4;aE++){c.push(new Bot(2))}return c})();am=(function(){var c;c=[];for(aE=0;aE<4;aE++){c.push(new Bot(2))}return c})();ao=(function(){var c;c=[];for(aE=0;aE<4;aE++){c.push(new Bot(2))}return c})();aq=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();at=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();aK=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();al=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();ar=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();au=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();aw=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();ay=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();aA=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();aC=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();av=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();ax=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();az=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();aB=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();aD=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();aF=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();aG=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();aH=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();aI=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();aJ=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();a=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();U=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();W=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();Y=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();aa=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();ac=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();ae=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();ag=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();ah=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();aj=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();an=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();ap=(function(){var c;c=[];for(aE=0;aE<2;aE++){c.push(new Bot(1))}return c})();i[0].friends=V.concat(i[1]);i[1].friends=X.concat(i[0]);V[0].friends=Z;V[1].friends=ab;V[2].friends=ad;V[3].friends=af;X[0].friends=ai;X[1].friends=ak;X[2].friends=am;X[3].friends=ao;Z[0].friends=aq;Z[1].friends=at;Z[2].friends=aK;Z[3].friends=al;ab[0].friends=ar;ab[1].friends=au;ab[2].friends=aw;ab[3].friends=ay;ad[0].friends=aA;ad[1].friends=aC;ad[2].friends=av;ad[3].friends=ax;af[0].friends=az;af[1].friends=aB;af[2].friends=aD;af[3].friends=aF;ai[0].friends=aG;ai[1].friends=aH;ai[2].friends=aI;ai[3].friends=aJ;ak[0].friends=a;ak[1].friends=U;ak[2].friends=W;ak[3].friends=Y;am[0].friends=aa;am[1].friends=ac;am[2].friends=ae;am[3].friends=ag;ao[0].friends=ah;ao[1].friends=aj;ao[2].friends=an;ao[3].friends=ap;return i.concat(V,X,Z,ab,ad,af,ai,ak,am,ao,aq,at,aK,al,ar,au,aw,ay,aA,aC,av,ax,az,aB,aD,aF,aG,aH,aI,aJ,a,U,W,Y,aa,ac,ae,ag,ah,aj,an,ap)};return b})();Rnd=(function(){function b(){}b.gate=function(a){var d;d=(Math.random()*100)<a;return d};b.next=function(a,d){if(a==null){a=1}if(d==null){d=0}return(Math.random()*a)+d};b.location=function(a){if(a==null){a=0}return new Vector(b.next(window.width-a,a),b.next(window.height-a,a))};b.velocity=function(){return new Vector(b.next(20)*b.sign(),b.next(20)*b.sign())};b.sign=function(){if(b.gate(50)){return 1}else{return -1}};return b})();Vector=(function(){function b(a,e,f){this.x=a!=null?a:0;this.y=e!=null?e:0;this.z=f!=null?f:0}b.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this.z+=a.z};b.prototype.get=function(){return new b(this.x,this.y,this.z)};b.prototype.cross=function(a){return new b(this.y*a.z-a.y*this.z,this.z*a.x-a.z*this.x,this.x*a.y-a.x*this.y)};b.prototype.div=function(a){var d;d=b.ensure(a);this.x/=d.x;this.y/=d.y;return this.z/=d.z};b.prototype.dist=function(a){var d;d=b.ensure(a);return b.dist(this,d)};b.prototype.hypot=function(a,e){if(a===0){return Math.abs(e)}else{return Math.abs(a)*Math.sqrt(1+Math.pow(e/a,2))}};b.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};b.prototype.heading=function(){return -Math.atan2(-this.y,this.x)};b.prototype.limit=function(a,e){var f;f=this.mag();if((a!=null)&&f>a){this.normalize();return this.mult(a)}else{if((e!=null)&&f<e){this.normalize();return this.mult(e)}}};b.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};b.prototype.mult=function(a){var d;d=b.ensure(a);this.x*=d.x;this.y*=d.y;return this.z*=d.z};b.prototype.normalize=function(){var a;a=this.mag();if(a>0){return this.div(a)}};b.prototype.set=function(f,g,h){var a;return a=[f,g,h],this.x=a[0],this.y=a[1],this.z=a[2],a};b.prototype.sub=function(a){this.x-=a.z;this.y-=a.y;return this.z-=a.z};b.prototype.toArray=function(){return[this.x,this.y,this.z]};b.prototype.toString=function(){return"x:@x, y:@y, z:@z"};b.add=function(a,f){var g,h;g=b.ensure(a);h=b.ensure(f);return new b(g.x+h.x,g.y+h.y,g.z+h.z)};b.sub=function(a,f){var g,h;g=b.ensure(a);h=b.ensure(f);return new b(g.x-h.x,g.y-h.y,g.z-h.z)};b.div=function(a,f){var g,h;g=b.ensure(a);h=b.ensure(f);return new b(g.x/h.x,g.y/h.y,g.z/h.z)};b.ensure=function(a){if(typeof a==="number"){return new b(a,a,a)}else{return a}};b.dist=function(j,k){var h,i,a;a=[(j!=null?j.x:void 0)-(k!=null?k.x:void 0),(j!=null?j.y:void 0)-(k!=null?k.y:void 0)],h=a[0],i=a[1];return this.hypot(h,i)};b.hypot=function(a,e){if(a===0){return Math.abs(e)}else{return Math.abs(a)*Math.sqrt(1+Math.pow(e/a,2))}};b.dot=function(a,d){return a.dot(d)};b.cross=function(a,d){return a.cross(d)};b.angleBetween=function(a,d){return Math.acos(a.dot(d)/(a.mag()*d.mag()))};return b})();var applyUniversalForces,attractors,bots,main,obstacles,processAttractors,processBots,processObstacles,resetAttractors,resetBots,resetObstacles,setupProcessing;bots=[];obstacles=[];attractors=[];$(function(){var a,b;$("#reset-obstacles").click(resetObstacles);$(".reset-obstacles").change(resetObstacles);$(".reset-attractors").change(resetAttractors);$(".reset-bots").change(resetBots);a=$('<canvas id="processing-canvas">').appendTo($("#screen"))[0];return b=new Processing(a,main)});main=function(b){var a;a=b;a.setup=setupProcessing(a);resetObstacles();resetAttractors();resetBots();return a.draw=function(){a.background(51);processObstacles();processAttractors();return processBots()}};setupProcessing=function(a){a.width=855;a.height=500;a.background(51);window.width=a.width;window.height=a.height;window.midX=(a.width/2)>>0;window.midY=(a.height/2)>>0;window.processing=a;return null};processObstacles=function(){var d,a,b,c;if(Repulsor.isVisible){c=[];for(a=0,b=obstacles.length;a<b;a++){d=obstacles[a];c.push(d.drawShape())}return c}};processAttractors=function(){var j,a,b,c,d,e,f,g,h,i;for(a=0,e=attractors.length;a<e;a++){j=attractors[a];applyUniversalForces(j)}for(b=0,f=attractors.length;b<f;b++){j=attractors[b];Drag.applyForce(j,0.001)}for(c=0,g=attractors.length;c<g;c++){j=attractors[c];j.move()}if(Attractor.isVisible){i=[];for(d=0,h=attractors.length;d<h;d++){j=attractors[d];i.push(j.drawShape())}return i}};processBots=function(){var r,s,t,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(a=0,e=bots.length;a<e;a++){s=bots[a];applyUniversalForces(s)}for(b=0,f=obstacles.length;b<f;b++){t=obstacles[b];for(c=0,g=bots.length;c<g;c++){s=bots[c];t.applyForce(s)}}for(d=0,h=attractors.length;d<h;d++){r=attractors[d];for(m=0,i=bots.length;m<i;m++){s=bots[m];r.applyForce(s)}}for(n=0,j=bots.length;n<j;n++){s=bots[n];Drag.applyForce(s)}for(o=0,k=bots.length;o<k;o++){s=bots[o];s.move()}q=[];for(p=0,l=bots.length;p<l;p++){s=bots[p];q.push(s.drawShape())}return q};applyUniversalForces=function(c){var d,a,b;for(a=0,b=bots.length;a<b;a++){d=bots[a];if(d!==c){Magnet.applyForce(c,d)}}return EdgeWrap.applyForce(c)};resetObstacles=function(){var a,b;Repulsor.isVisible=$("#obstacle-show").is(":checked");b=parseInt($("#obstacle-count").val());obstacles=(function(){var c;c=[];for(a=0;0<=b?a<b:a>b;0<=b?a++:a--){c.push(new Repulsor())}return c})();return null};resetAttractors=function(){var a,b;Attractor.isVisible=$("#attractor-show").is(":checked");a=parseInt($("#attractor-count").val());attractors=(function(){var c;c=[];for(b=0;0<=a?b<a:b>a;0<=a?b++:b--){c.push(new Attractor())}return c})();return null};resetBots=function(){var a;a=parseInt($("#bot-count").val());bots=BotBuilder.flock(a);return null};